pipeline {
    environment {
        registry = "docker_hub_account/repository_name"
        registryCredential = 'dockerhub'
    }
    agent none
    stages {
        stage('Test') {
            agent { dockerfile true }
            node {
                def customImage = docker.build("test-image", "./Dockerfile") 
                customImage.inside{
                    sh 'ls'
                }
            }
            steps {
                echo 'Test start?'
                sh 'pwd'
                sh 'ls'
                node {
                    def customImage = docker.build("test-image", "./Dockerfile") 
                    customImage.inside{
                        sh 'ls'
                    }
                }

            }
        }
        stage('Test1'){
            steps {
                echo 'Test1 start?'
            }
        }
        stage('Test2'){
            steps{
                echo 'Test2 start?'
            }
        }
    }
    post {
        always {
            echo 'I will always say Hello again!'
        }
    }
}
